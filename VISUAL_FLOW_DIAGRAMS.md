# ğŸ“Š Visual Flow Diagrams - Auto-Refresh Implementation

## 1. Overall System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PERPUS APPLICATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   USER     â”‚      â”‚   PETUGAS    â”‚      â”‚     ADMIN        â”‚  â”‚
â”‚  â”‚            â”‚      â”‚              â”‚      â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ Create   â”‚      â”‚ â€¢ Dashboard  â”‚      â”‚ â€¢ Dashboard      â”‚  â”‚
â”‚  â”‚ â€¢ View     â”‚      â”‚ â€¢ Approve    â”‚      â”‚ â€¢ Final Approve  â”‚  â”‚
â”‚  â”‚ â€¢ Receive  â”‚      â”‚ â€¢ Reject     â”‚      â”‚ â€¢ Reject         â”‚  â”‚
â”‚  â”‚   Proof    â”‚      â”‚ â€¢ Return     â”‚      â”‚ â€¢ Manage All     â”‚  â”‚
â”‚  â”‚   Page     â”‚      â”‚   Verify     â”‚      â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†‘                    â†‘                       â†‘             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                              â”‚                                    â”‚
â”‚                    Database (MySQL)                              â”‚
â”‚         â€¢ borrowings (status enum)                               â”‚
â”‚         â€¢ notifications                                          â”‚
â”‚         â€¢ users, books                                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Auto-Refresh Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER CREATES BORROWING                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Status: "pending"      â”‚
                    â”‚ QR Code: Generated     â”‚
                    â”‚ Redirect: /proof page  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PROOF PAGE LOADED     â”‚
                    â”‚                        â”‚
                    â”‚ â€¢ Modal: static        â”‚
                    â”‚ â€¢ JS: polling starts   â”‚
                    â”‚ â€¢ Interval: 5 seconds  â”‚
                    â”‚ â€¢ Timeout: 5 minutes   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   POLLING LOOP (Every 5 Seconds)           â”‚
        â”‚                                             â”‚
        â”‚  1. fetch('/borrowings/{id}/proof')        â”‚
        â”‚  2. Parse HTML response                    â”‚
        â”‚  3. Get: newStatus from data-borrowing-status
        â”‚  4. Compare: newStatus vs currentStatus    â”‚
        â”‚  5. If different & not 'pending'           â”‚
        â”‚     â†’ location.reload()                     â”‚
        â”‚  6. Else â†’ wait 5 more seconds             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   STATUS CHANGE DETECTED âœ…                â”‚
        â”‚   (e.g., pending â†’ pending_petugas)        â”‚
        â”‚                                             â”‚
        â”‚   â†“ Auto Reload â†“                          â”‚
        â”‚                                             â”‚
        â”‚   â€¢ Clear polling interval                 â”‚
        â”‚   â€¢ Page reload                            â”‚
        â”‚   â€¢ Load new content                       â”‚
        â”‚   â€¢ Modal disappears                       â”‚
        â”‚   â€¢ Status badge updated                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PAGE RELOADED - New Status Shown         â”‚
        â”‚                                             â”‚
        â”‚   Badge: "Menunggu Konfirmasi Admin"       â”‚
        â”‚   Message: Status updated                  â”‚
        â”‚   Modal: Hidden (not shown for non-pending)â”‚
        â”‚   Polling: Continues (if still pending)    â”‚
        â”‚   or Stopped (if no longer pending)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Status Transition with Auto-Refresh Timeline

```
Timeline (Minutes)
â”‚
0 â”œâ”€ User Creates Borrowing
  â”‚  â””â”€ Status: pending
  â”‚     Proof Page: Modal shown â³
  â”‚     Polling: STARTED â–¶ï¸
  â”‚     data-borrowing-status: "pending"
  â”‚
0.5 â”œâ”€ (User still waiting...)
  â”‚  â””â”€ Polling check #1 â†’ no change
  â”‚
1 â”œâ”€ (User still waiting...)
  â”‚  â””â”€ Polling check #2 â†’ no change
  â”‚
1.5 â”œâ”€ Petugas clicks APPROVE
  â”‚  â””â”€ Database: pending â†’ pending_petugas âœ“
  â”‚     Notification sent to user
  â”‚     (User doesn't know yet)
  â”‚
2 â”œâ”€ (Auto-polling working...)
  â”‚  â””â”€ Polling check #3
  â”‚     â†’ newStatus: "pending_petugas"
  â”‚     â†’ currentStatus: "pending"
  â”‚     â†’ Different! â†’ location.reload() â†»
  â”‚
2.2 â”œâ”€ PAGE RELOADED AUTOMATICALLY âœ…
  â”‚  â””â”€ Modal: HIDDEN
  â”‚     Status: "Menunggu Konfirmasi Admin" (blue)
  â”‚     Polling: CONTINUES â–¶ï¸ (still waiting for admin)
  â”‚
3 â”œâ”€ (User might close tab or leave)
  â”‚  â””â”€ Polling still running...
  â”‚
5 â”œâ”€ Admin clicks APPROVE
  â”‚  â””â”€ Database: pending_petugas â†’ active âœ“
  â”‚     Notification sent to user
  â”‚
5.3 â”œâ”€ PAGE RELOADED AUTOMATICALLY âœ… (2nd reload)
  â”‚  â””â”€ Status: "Sedang Dipinjam" (green)
  â”‚     Modal: Hidden
  â”‚     Polling: STOPS ğŸ›‘ (status not pending anymore)
  â”‚
6 â”œâ”€ Auto-polling STOPPED
  â”‚  â””â”€ No more fetch requests
  â”‚     Browser resource freed
  â”‚
7-10 â”œâ”€ (User can still manual refresh if needed)
  â”‚  â””â”€ Button "Cek Status" still available
  â”‚     Browser sleep mode safe
  â”‚
```

---

## 4. JavaScript Polling Logic Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOMContentLoaded Event Triggered                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Show Pending Modal        â”‚
      â”‚ (Status = 'pending')      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ START Auto-Refresh Interval      â”‚
    â”‚ Repeat every 5000ms (5 seconds)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POLLING ITERATION (Every 5 Seconds)       â”‚
   â”‚                                            â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 1. FETCH REQUEST                    â”‚   â”‚
   â”‚ â”‚    fetch(window.location.href, {    â”‚   â”‚
   â”‚ â”‚      method: 'GET',                 â”‚   â”‚
   â”‚ â”‚      headers: {                     â”‚   â”‚
   â”‚ â”‚        'Accept': 'text/html'        â”‚   â”‚
   â”‚ â”‚      }                              â”‚   â”‚
   â”‚ â”‚    })                               â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 2. GET RESPONSE TEXT                â”‚   â”‚
   â”‚ â”‚    .then(response => response.text())   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 3. PARSE HTML                       â”‚   â”‚
   â”‚ â”‚    const parser = new DOMParser();  â”‚   â”‚
   â”‚ â”‚    const doc = parser               â”‚   â”‚
   â”‚ â”‚      .parseFromString(html)         â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 4. EXTRACT NEW STATUS               â”‚   â”‚
   â”‚ â”‚    const newStatus = doc            â”‚   â”‚
   â”‚ â”‚      .querySelector(                â”‚   â”‚
   â”‚ â”‚        '[data-borrowing-status]'    â”‚   â”‚
   â”‚ â”‚      )?.getAttribute(               â”‚   â”‚
   â”‚ â”‚        'data-borrowing-status'      â”‚   â”‚
   â”‚ â”‚      )                              â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 5. GET CURRENT STATUS               â”‚   â”‚
   â”‚ â”‚    const currentStatus = document   â”‚   â”‚
   â”‚ â”‚      .querySelector(                â”‚   â”‚
   â”‚ â”‚        '[data-borrowing-status]'    â”‚   â”‚
   â”‚ â”‚      )?.getAttribute(               â”‚   â”‚
   â”‚ â”‚        'data-borrowing-status'      â”‚   â”‚
   â”‚ â”‚      )                              â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ 6. COMPARE STATUS                   â”‚   â”‚
   â”‚ â”‚    if (newStatus &&                 â”‚   â”‚
   â”‚ â”‚        newStatus !== currentStatus &&   â”‚
   â”‚ â”‚        newStatus !== 'pending')     â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                â†“                          â”‚
   â”‚                â”‚                         â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
   â”‚    â†“                      â†“              â”‚
   â”‚  YES                     NO             â”‚
   â”‚  â”‚                       â”‚              â”‚
   â”‚  â”œâ”€â†’ location.reload()   â”œâ”€â†’ Continue  â”‚
   â”‚      (Page reloads)          waiting   â”‚
   â”‚      (Polling stops)         5 sec     â”‚
   â”‚                                        â”‚
   â”‚ .catch(error => {                      â”‚
   â”‚   console.log('Error:', error)         â”‚
   â”‚ })                                     â”‚
   â”‚                                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“ (repeat every 5 sec)
              POLLING CONTINUES
                   â”‚
                   â†“ (after 5 minutes total)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ TIMEOUT TRIGGERED        â”‚
        â”‚ clearInterval(...)       â”‚
        â”‚ Polling STOPPED ğŸ›‘       â”‚
        â”‚ Resource freed           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Modal Behavior States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MODAL STATES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  STATE 1: PENDING                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Status: "pending" OR "pending_petugas"     â”‚   â”‚
â”‚  â”‚ Modal: VISIBLE                             â”‚   â”‚
â”‚  â”‚ Message: "â³ Menunggu Konfirmasi..."       â”‚   â”‚
â”‚  â”‚ Buttons: [Dashboard] [Cek Status] [Tutup] â”‚   â”‚
â”‚  â”‚ Can dismiss: NO (static backdrop)          â”‚   â”‚
â”‚  â”‚ Can press ESC: NO (keyboard: false)        â”‚   â”‚
â”‚  â”‚ Polling: ACTIVE â–¶ï¸                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                              â”‚
â”‚  STATE 2: APPROVED (after page reload)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Status: "active" OR "returned"             â”‚   â”‚
â”‚  â”‚ Modal: HIDDEN                              â”‚   â”‚
â”‚  â”‚ Message: Status badge + description        â”‚   â”‚
â”‚  â”‚ Buttons: Available (not in modal)           â”‚   â”‚
â”‚  â”‚ Can dismiss: YES (modal gone)               â”‚   â”‚
â”‚  â”‚ Can press ESC: YES (no modal)               â”‚   â”‚
â”‚  â”‚ Polling: STOPPED ğŸ›‘                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                              â”‚
â”‚  STATE 3: REJECTED (if admin tolak)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Status: deleted from database              â”‚   â”‚
â”‚  â”‚ Modal: HIDDEN                              â”‚   â”‚
â”‚  â”‚ Message: Error alert OR redirect to books  â”‚   â”‚
â”‚  â”‚ Buttons: Back to books                     â”‚   â”‚
â”‚  â”‚ Polling: STOPPED ğŸ›‘                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Data Flow: From Approval to User Screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Petugas clicks "Setujui"      â”‚
â”‚   POST /petugas/borrowings/{id}/â”‚
â”‚       approve-pending           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Controller Method: â”‚
        â”‚ approvePending()   â”‚
        â”‚                    â”‚
        â”‚ â€¢ Validate status  â”‚
        â”‚ â€¢ Update: pending  â”‚
        â”‚   â†’ pending_petugasâ”‚
        â”‚ â€¢ Create notify    â”‚
        â”‚ â€¢ Return redirect  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Database Update            â”‚
        â”‚                             â”‚
        â”‚  borrowings table:          â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ id    â”‚ status       â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚ 1234 â”‚ pending_petgasâ”‚   â”‚ â† CHANGED!
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                             â”‚
        â”‚  notifications table:       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ id  â”‚ user_id â”‚ type â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚ 999 â”‚ 5       â”‚ approved_petgas â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  User's Browser is Polling...       â”‚
   â”‚                                     â”‚
   â”‚  T+0 sec: Check status â†’ pending âœ“  â”‚
   â”‚  T+5 sec: Check status â†’ pending âœ“  â”‚
   â”‚  T+10 sec: NEW DATA from fetch      â”‚
   â”‚            newStatus: "pending_petgas" â† CHANGED!
   â”‚            â†“ NOT EQUAL â†“             â”‚
   â”‚            â†“ TRIGGER RELOAD â†“        â”‚
   â”‚                                     â”‚
   â”‚  location.reload()                  â”‚
   â”‚         â†“                           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Browser Reloads Page       â”‚
   â”‚  GET /borrowings/{id}/proof â”‚
   â”‚         â†“                   â”‚
   â”‚  Fresh data from server:    â”‚
   â”‚  â€¢ status: "pending_petgas" â”‚
   â”‚  â€¢ Modal: NOT shown         â”‚
   â”‚  â€¢ Badge: BLUE              â”‚
   â”‚  â€¢ Message: "Menunggu Admin"â”‚
   â”‚         â†“                   â”‚
   â”‚  User SEES NEW STATUS âœ…     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Database Enum Status Values

```
BORROWING STATUS ENUM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           â”‚
â”‚  'pending'           â† Initial state      â”‚
â”‚      â†“               (waiting petugas)    â”‚
â”‚  'pending_petugas'   â† After petugas OK   â”‚
â”‚      â†“               (waiting admin)      â”‚
â”‚  'active'            â† After admin OK     â”‚
â”‚      â†“               (book ready)         â”‚
â”‚  'returned'          â† Book returned      â”‚
â”‚  'overdue'           â† Past due date      â”‚
â”‚                                           â”‚
â”‚  âœï¸ Managed in:                          â”‚
â”‚  â€¢ app/Models/Borrowing.php              â”‚
â”‚  â€¢ database/migrations/...php            â”‚
â”‚                                           â”‚
â”‚  âœ… Auto-refresh monitors:               â”‚
â”‚  â€¢ pending â†’ other = RELOAD              â”‚
â”‚  â€¢ pending_petugas â†’ other = RELOAD      â”‚
â”‚  â€¢ active/returned = NO reload (stop)    â”‚
â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Performance Timeline

```
Resources Used Over Time (5-minute period)

Network:
â”‚
10â”‚     â—     â—     â—     â—     â—     â—     â—     â—     â—     â—     â—     â—
  â”‚ (GET /borrowings/{id}/proof requests)
  â”‚
 5â”‚     â— â† Each ~100-500 bytes
  â”‚
 0â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€
  0    30    60    90   120   150   180   210   240   270   300   330
                                Time (seconds)
                        â†‘
                   Polling stops after 5 min

Memory (MB):
â”‚
50â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (stable, no growth)
30â”‚
  â”‚
10â”‚ âœ“ No memory leak
  â”‚ âœ“ Interval cleared
  â”‚ âœ“ Browser auto-cleanup
  â”‚
 0â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  0    30    60    90   120   150   180   210   240   270   300   330

CPU:
â”‚
10â”‚     â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” (very minimal)
  â”‚â”€â”€â”€â”€â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”€â”€â”€ (spikes at fetch)
 5â”‚
  â”‚
  â”‚ âœ“ Minimal usage
  â”‚ âœ“ No continuous processing
  â”‚
 0â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  0    30    60    90   120   150   180   210   240   270   300   330
```

---

## 9. Comparison: Before vs After

```
BEFORE (Old Flow)                  â”‚  AFTER (New Flow)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User creates borrowing             â”‚  User creates borrowing
         â†“                          â”‚           â†“
Redirect to proof page             â”‚  Redirect to proof page
         â†“                          â”‚           â†“
Modal shows                         â”‚  Modal shows
         â†“                          â”‚           â†“
User WAITS... (manual refresh)     â”‚  Browser AUTO-CHECKS every 5 sec
         â†“                          â”‚           â†“
Status changes in DB (behind)      â”‚  Status changes in DB (behind)
         â†“                          â”‚           â†“
User must F5 or refresh button     â”‚  Browser DETECTS change automatically
         â†“                          â”‚           â†“
THEN sees new status               â”‚  Page RELOADS â†’ NEW STATUS visible
         â†“                          â”‚           â†“
Takes: ?? minutes (user dependent) â”‚  Takes: < 5 seconds (automatic)
         â†“                          â”‚           â†“
UX: Manual, frustrating             â”‚  UX: Seamless, automatic âœ…

                      IMPROVEMENT: ~âˆ (infinite better UX)
```

---

## 10. Browser Console Monitoring

```
CONSOLE OUTPUT (What you'd see):

[14:30:45.123] âœ“ Proof page loaded
[14:30:45.456] âœ“ Pending modal shown
[14:30:45.789] âœ“ Auto-refresh polling started
[14:30:45.890] data-borrowing-status = "pending"

[14:30:50.123] Auto-refresh check #1
[14:30:50.234] âœ“ Fetch returned: status still "pending"
[14:30:50.235] No change detected, continue polling

[14:30:55.123] Auto-refresh check #2
[14:30:55.234] âœ“ Fetch returned: status still "pending"
[14:30:55.235] No change detected, continue polling

[14:31:00.123] Auto-refresh check #3
[14:31:00.234] âœ“ Fetch returned: status changed to "pending_petgas"
[14:31:00.235] âœ“ Status change detected!
[14:31:00.236] âœ“ Reloading page...

[14:31:01.500] âœ“ Page reloaded
[14:31:01.600] âœ“ New status loaded: "pending_petgas"
[14:31:01.700] âœ“ Modal hidden for new status
[14:31:01.800] âœ“ Auto-refresh polling continues...

[14:31:35.123] Auto-refresh check continues...

[14:35:00.000] âœ“ 5-minute timeout reached
[14:35:00.100] âœ“ Polling interval cleared
[14:35:00.200] âœ“ Auto-refresh STOPPED
[14:35:00.300] â„¹ User can still manual refresh if needed
```

---

**Legend**:
- âœ… Success
- âŒ Failure
- â„¹ï¸  Information
- â–¶ï¸  Running
- ğŸ›‘ Stopped
- â™»ï¸  Reloading
- â³ Waiting
- ğŸ” Security
- ğŸ“Š Monitoring

